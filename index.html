<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CopyPaste - Compartilhe CÃ³digo</title>
    <script src="https://cdn.jsdelivr.net/npm/peerjs@1.5.2/dist/peerjs.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/atom-one-dark.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Monaco', 'Courier New', monospace; background: #0d1117; color: #c9d1d9; min-height: 100vh; padding: 10px; }
        .container { max-width: 1400px; margin: 0 auto; display: grid; grid-template-columns: 1fr 1fr; gap: 15px; height: 100vh; }
        @media (max-width: 768px) { .container { grid-template-columns: 1fr; height: auto; } }
        .panel { background: #161b22; border: 1px solid #30363d; border-radius: 6px; padding: 15px; display: flex; flex-direction: column; overflow: hidden; }
        .header { display: flex; align-items: center; justify-content: space-between; margin-bottom: 15px; padding-bottom: 12px; border-bottom: 1px solid #30363d; }
        .header h2 { font-size: 1.1rem; color: #58a6ff; margin: 0; }
        .badge { padding: 4px 8px; border-radius: 12px; font-size: 0.75rem; font-weight: 600; }
        .badge.ok { background: #238636; color: #3fb950; }
        .badge.err { background: #da3633; color: #ff7b72; }
        .code-box { background: #0d1117; border: 1px solid #30363d; border-radius: 6px; padding: 12px; margin-bottom: 10px; text-align: center; }
        .code-val { font-size: 1.8rem; font-weight: bold; letter-spacing: 4px; color: #58a6ff; margin: 10px 0; font-family: monospace; word-break: break-all; }
        .btn { padding: 10px 15px; border: 1px solid #30363d; background: #0d1117; color: #58a6ff; border-radius: 6px; cursor: pointer; font-weight: 600; transition: 0.2s; width: 100%; }
        .btn:hover { background: #161b22; border-color: #58a6ff; }
        .btn-green { background: #238636; border-color: #238636; color: white; }
        .btn-green:hover { background: #2ea043; }
        .btn:disabled { opacity: 0.5; cursor: not-allowed; }
        .row { display: flex; gap: 8px; margin-bottom: 10px; }
        .row input { flex: 1; background: #0d1117; border: 1px solid #30363d; color: #c9d1d9; padding: 10px; border-radius: 6px; font-family: inherit; font-size: 0.9rem; }
        .row input:focus { outline: none; border-color: #58a6ff; }
        .row button { width: auto; white-space: nowrap; }
        .editor { position: relative; flex: 1; border: 1px solid #30363d; border-radius: 6px; overflow: hidden; background: #0d1117; margin-bottom: 10px; }
        textarea, pre { position: absolute; top: 0; left: 0; width: 100%; height: 100%; margin: 0; padding: 12px; font-family: inherit; font-size: 0.9rem; line-height: 1.5; border: none; }
        textarea { background: transparent; color: #c9d1d9; z-index: 2; caret-color: #58a6ff; resize: none; }
        pre { background: #0d1117; color: #8b949e; z-index: 1; overflow: hidden; pointer-events: none; }
        pre code { padding: 0; background: none; }
        .notif { position: fixed; top: 10px; right: 10px; background: #238636; color: white; padding: 12px 16px; border-radius: 6px; z-index: 1000; animation: slide 0.3s; }
        .notif.err { background: #da3633; }
        @keyframes slide { from { transform: translateX(400px); opacity: 0; } to { transform: translateX(0); } }
        .label { font-size: 0.8rem; color: #8b949e; margin-bottom: 8px; margin-top: 15px; }
        .label:first-of-type { margin-top: 0; }
        details { margin-bottom: 10px; }
        details > summary { cursor: pointer; color: #58a6ff; font-weight: 600; font-size: 0.9rem; }
        .id-full { background: #0d1117; border: 1px solid #30363d; padding: 10px; border-radius: 4px; margin-top: 8px; font-size: 0.75rem; word-break: break-all; color: #58a6ff; max-height: 100px; overflow-y: auto; }
    </style>
</head>
<body>
    <div class="container">
        <div class="panel">
            <div class="header">
                <h2>ğŸ“¤ Seu ID</h2>
                <span class="badge" id="status">â³</span>
            </div>
            <div class="code-box">
                <div style="font-size: 0.8rem; color: #8b949e;">ID (6 dÃ­gitos)</div>
                <div class="code-val" id="shortId">---</div>
                <button class="btn btn-green" onclick="copyShort()">ğŸ“‹ Copiar</button>
            </div>
            <details>
                <summary>ğŸ“ Ver ID Completo</summary>
                <div class="id-full" id="fullId">Gerando...</div>
                <button class="btn" style="margin-top: 8px;" onclick="copyFull()">ğŸ“‹ Copiar Completo</button>
            </details>
            <div class="label">Cole o ID do outro usuÃ¡rio:</div>
            <div class="row">
                <input id="peerInput" placeholder="Cole aqui o ID completo" autocomplete="off">
                <button class="btn btn-green" onclick="connectPeer()">ğŸ”— Conectar</button>
            </div>
            <div style="font-size: 0.7rem; color: #8b949e; margin-top: 20px; padding: 10px; background: #0d1117; border-radius: 4px; line-height: 1.6;">
                <strong>Como usar:</strong><br>
                1. Copie seu ID COMPLETO<br>
                2. Compartilhe com o outro<br>
                3. Ele cola aqui e conecta<br>
                4. Podem enviar cÃ³digo!
            </div>
        </div>

        <div class="panel">
            <div class="header">
                <h2>ğŸ’» CÃ³digo</h2>
                <span id="connStatus" style="font-size: 0.8rem;">âš« Desconectado</span>
            </div>
            <div class="label">Seu cÃ³digo:</div>
            <div class="editor">
                <pre><code id="hl1"></code></pre>
                <textarea id="text1" placeholder="Cole ou escreva cÃ³digo aqui..."></textarea>
            </div>
            <div class="row">
                <button class="btn" onclick="copyText1()">ğŸ“‹ Copiar</button>
                <button class="btn btn-green" id="sendBtn" onclick="sendCode()" disabled>ğŸ“¤ Enviar (Ctrl+Enter)</button>
            </div>
            <div class="label">CÃ³digo Recebido:</div>
            <div class="editor">
                <pre><code id="hl2"></code></pre>
                <textarea id="text2" readonly placeholder="Aguardando cÃ³digo..."></textarea>
            </div>
            <div class="row">
                <button class="btn" onclick="copyText2()">ğŸ“‹ Copiar</button>
                <button class="btn" id="clearBtn" onclick="clearText2()" disabled>ğŸ—‘ï¸ Limpar</button>
            </div>
        </div>
    </div>

    <script>
        let peer, conn, myFullId;

        function initPeer() {
            console.log('[INIT] Iniciando...');
            peer = new Peer({
                config: {
                    iceServers: [
                        { urls: 'stun:stun.l.google.com:19302' },
                        { urls: 'stun:stun1.l.google.com:19302' },
                        { urls: 'stun:stun2.l.google.com:19302' },
                        { urls: 'stun:stun3.l.google.com:19302' },
                        { urls: 'stun:stun4.l.google.com:19302' },
                        { urls: 'turn:metered.ca:443?transport=tcp', username: 'webrtc', credential: 'webrtc' },
                        { urls: 'turn:metered.ca:443?transport=udp', username: 'webrtc', credential: 'webrtc' }
                    ]
                }
            });

            peer.on('open', (id) => {
                console.log('[OPEN] ID:', id);
                myFullId = id;
                document.getElementById('shortId').textContent = id.substring(0, 6).toUpperCase();
                document.getElementById('fullId').textContent = myFullId;
                document.getElementById('status').textContent = 'âœ… Pronto';
                document.getElementById('status').className = 'badge ok';
            });

            peer.on('connection', (c) => {
                console.log('[CONN] Nova conexÃ£o');
                setupConnection(c);
            });

            peer.on('error', (err) => {
                console.error('[ERROR]', err);
                document.getElementById('status').textContent = 'âŒ Erro';
                document.getElementById('status').className = 'badge err';
            });
        }

        function setupConnection(c) {
            conn = c;

            conn.on('open', () => {
                console.log('[OPEN CONN]');
                document.getElementById('sendBtn').disabled = false;
                document.getElementById('connStatus').textContent = 'ğŸŸ¢ Conectado';
                notify('âœ… Conectado!');
            });

            conn.on('data', (data) => {
                console.log('[DATA]');
                document.getElementById('text2').value = data;
                document.getElementById('hl2').textContent = data;
                document.getElementById('clearBtn').disabled = false;
                highlight('text2', 'hl2');
                notify('ğŸ“© Recebido!');
            });

            conn.on('close', () => {
                console.log('[CLOSE]');
                document.getElementById('sendBtn').disabled = true;
                document.getElementById('connStatus').textContent = 'âš« Desconectado';
            });

            conn.on('error', (err) => {
                console.error('[CONN ERROR]', err);
                notify('Erro: ' + err.type, true);
            });
        }

        function connectPeer() {
            const id = document.getElementById('peerInput').value.trim();
            if (!id || id.length < 15) {
                notify('Cole o ID COMPLETO (nÃ£o o curto)', true);
                return;
            }
            console.log('[CONNECT] ID:', id.substring(0, 20) + '...');
            if (conn) conn.close();
            conn = peer.connect(id);
            setupConnection(conn);
            notify('ï¿½ï¿½ Conectando...');
        }

        function sendCode() {
            const code = document.getElementById('text1').value;
            if (!code.trim()) {
                notify('Digite algo', true);
                return;
            }
            if (!conn || !conn.open) {
                notify('NÃ£o conectado', true);
                return;
            }
            conn.send(code);
            notify('ğŸ“¤ Enviado!');
        }

        function highlight(id, hlid) {
            try {
                const txt = document.getElementById(id).value;
                const code = document.getElementById(hlid);
                let lang = 'plaintext';
                if (txt.includes('function ') || txt.includes('const ')) lang = 'javascript';
                else if (txt.includes('def ')) lang = 'python';
                else if (txt.includes('<')) lang = 'html';
                else if (txt.includes('{')) lang = 'json';
                code.textContent = txt;
                code.className = lang;
                hljs.highlightElement(code);
            } catch(e) {}
        }

        function copyShort() {
            navigator.clipboard.writeText(document.getElementById('shortId').textContent).then(() => notify('ID copiado!'));
        }

        function copyFull() {
            if (!myFullId) { notify('ID nÃ£o gerado', true); return; }
            navigator.clipboard.writeText(myFullId).then(() => notify('ID COMPLETO copiado!'));
        }

        function copyText1() {
            const txt = document.getElementById('text1').value;
            if (!txt) { notify('Nada para copiar', true); return; }
            navigator.clipboard.writeText(txt).then(() => notify('Copiado!'));
        }

        function copyText2() {
            const txt = document.getElementById('text2').value;
            if (!txt) { notify('Nada para copiar', true); return; }
            navigator.clipboard.writeText(txt).then(() => notify('Copiado!'));
        }

        function clearText2() {
            document.getElementById('text2').value = '';
            document.getElementById('hl2').textContent = '';
            document.getElementById('clearBtn').disabled = true;
        }

        function notify(msg, err = false) {
            const n = document.createElement('div');
            n.className = 'notif ' + (err ? 'err' : '');
            n.textContent = msg;
            document.body.appendChild(n);
            setTimeout(() => n.remove(), 3500);
        }

        document.getElementById('text1').addEventListener('input', () => highlight('text1', 'hl1'));
        document.getElementById('text1').addEventListener('keydown', (e) => {
            if (e.key === 'Enter' && e.ctrlKey) sendCode();
        });
        document.getElementById('peerInput').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') connectPeer();
        });

        initPeer();
    </script>
</body>
</html>
